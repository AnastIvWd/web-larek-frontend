# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание данных и типов
Товар
``` TS
export interface IProductItem {
  _id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number;
}
```

Заказ
``` TS
export interface IOrder {
  payment: string;
  email: string;
  phone: string;
  address: string;
}
```

Интерфейс для модели данных 
``` TS
export interface IAppData {
  products: IProductItem[];
  preview: string | null; 
  cart: IProductItem[];
  order: IOrder;
  error: string | null;
  addProductInCart(product: IProductItem): void;
  deleteProductFromCart(productId: string): void;
  getProductItem(productId: string): IProductItem;
  checkValidation(data: Record<keyof TValidation, string>):boolean;
  setPaymentInfo(paymentInfo: TPaymentInfo):void;
  setOrderContacts(contacts: TOrderContacts):void;
  resetCart():void;
  getItemsTotal(): number;
  getCartItems(): IProductItem[];
}
```

Данные товара, используемые в модальном окне товара
``` TS
export type TProductInfo = Pick<IProductItem, 'category' | 'title' | 'description' | 'price'>;
```

Данные пользователя, необходимые для оформления заказа
``` TS
export type TPaymentInfo = Pick<IOrder, 'payment' | 'address' | 'error'>;
```

Данные пользователя, необходимые для оформления заказа
``` TS
export type TOrderContacts = Pick<IOrder, 'email' | 'phone' | 'error'>;
```


## Архитектура приложения
Код приложения разделен на слои согласно парадигме MVP:
- слой представления - отвечает за отображение данных на странице;
- слой данных - отвечает за хранение и изменение данных;
- презентер - отвечает за связь представления и данных.


### Базовый код

#### Класс `Api`
Содержит базовую логику для отправки запросов. Конструктор принимает базовый URL сервера и опциональный объект с заголовками запросов.\
Методы:
- `get` - выполняет GET запрос к указанному в параметрах эндпоинту и возвращает промис с объектом, полученным от сервера;
- `post` - принимает объект с данными, которые будут отправлены в JSON формате в теле запроса, и отправляет эти данные на указанный эндпоинт. По умолчанию используется метод `POST`, но его можно изменить, задав третий параметр при вызове метода.

#### Класс `EventEmitter`

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в различных слоях приложения для их генерации.\
Основные методы (описаны интерфейсом `IEvents`):
- `on` - устанавливает обработчик на событие;
- `emit` - вызывает событие;
- `trigger` - делает коллбек триггер, генерирующий событие при вызове.


### Слой данных

#### Класс `AppData `
Класс отвечает за хранению и логику работы всех данных, присутствующих в приложении.\
Конструктор класса получает объект брокера событий.\
В полях класса хранятся следующие данные:
- `products: IProductItem[]` - массив объектов товаров;
- `preview: string | null` - id выбранного товара, необходимый для открытия модалького окна и добавления товара в корзину;
- `cart: IProductItem[]` - массив товаров, находящихся в корзине;
- `order: IOrder` - данные, необходимые для оформления заказа;
- `error: string | null` - ошибки валидации форм
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных. 

Также класс содержит такие методы, как: 
- `addProductInCart(product: IProductItem): void` - добавляет товар в конец списка товаров в корзине и вызывает событие изменения массива;
- `deleteProductFromCart(productId: string): void` - удаляет товар из корзины и вызывает событие изменения массива;
- `getProductItem(productId: string): IProductItem` - возвращает товар по его `id`;
- `checkValidation(data: Record<keyof TValidation, string>):boolean` - проверяет объект с данными заказа на валидность;
- `setPaymentInfo(paymentInfo: TPaymentInfo):void` - обновляет значение полей `address` и `payment`;
- `setOrderContacts(contacts: TOrderContacts):void` - обновляет значение полей `email` и `phone`;
- `resetCart():void` - обнуляет массив товаров в корзине при успешном оформлении заказа;
- `getItemsTotal():void` - считает итоговую сумму всех добавленных товаров в корзину;
- а так же сеттеры и геттеры для сохранения и получения данных из полей класса.


### Классы предствления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных. 

#### Класс `ModalView`
Базовый класс отображения модальных окон в приложении.
- Имеет методы `show` и `hide` для открытия и закрытия модального окна.
- Также для закрытия модального окна устанавливает следующие слушатели:
  - слушатель на клавиатуру для закрытия модального окна через Esc;
  - на клик по оверлею и кнопку крестик.
- Конструктор: `constructor(id: string, events: IEvents)` - принимает идентификатор элемента, по которому будет определяться конкретный элемент и экземпляр класса EventEmitter для инициации событий.
- Поля класса:
    - view: HTMLElement - элемент модального окна
    - events: IEvents - брокер событий

#### Класс `Confirm`
При открытии модального окна сохраняется обработчик, который передается в параметрах и будет вызван при подтверждении действия.\
Поля класса:
- `submitButton: HTMLButtonElement` - кнопка подтверждения;
- `handleSubmit: Function` - функция, которая будет выполнена после подтверждения.

Методы:
- `setTotal(total: number): void` - устанавливает значение итоговой суммы заказа.

#### Класс `Form`
Предназначен для реализации формы, содержащей поля ввода. При подтверждении создает событие, передавая в него объект с данными из полей ввода. При изменеии данных в полях ввода создает событие изменения данных. Предоставляет методы для отображения ошибок и управления состоянием активности кнопки подтверждения. \
Поля класса:
- `submitButton: HTMLButtonElement` - кнопка подтверждения;
- `_form: HTMLFormElement` - элемент формы;
- `formName: string` - значение атрибута `name` формы;
- `inputs: NodeListOf<HTMLInputElement>` - набор полей ввода формы;
- `errors: Record<string, HTMLElement>` - объект, содержащий элементы для отображения под полями формы с привязкой к атрибуту `name` инпутов. 

Методы:
- `setValid(isValid: boolean): void` - изменяет состояния активности кнопки подтверждения;
- `getInputValues(): Record<string, string>` - возвращает объект с данными из полей формы. Ключ - `name` инпута; значение - данные, введенные пользователем;
- `setInputValues(data: Record<string, string>): void` - принимает объект с данными для заполенния полей формы;
- `setError(data: {field: string, value: string, validInformation: string): void})` - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода;
- `showError (field: string, errorMessage: string): void` - отображает текст ошибки под указанным полем ввода;
- `hideInputError (field: string): void` - удаляет текст ошибки под указанным полем ввода;
- `get form: HTMLElement` - геттер для получения элемента формы.

#### Класс `Cart`
Предназначен для реализации корзины. При подтверждении создает событие, передавая в него объект с данными массива товаров. При удалении товаров из корзины, изменяет и созраняет данные массива товаров.\
Поля класса:
- `submitButton: HTMLButtonElement` - кнопка подтверждения;
- `_form: HTMLFormElement` - элемент формы;
- `formName: string` - значение атрибута `name` формы;
- `cartItems: IProductItem[]` - список товаров в корзине;
- `handleSubmit: Function` - функция, которая будет выполнена после подтверждения.

Методы:
- `setValid(isValid: boolean): void` - изменяет состояния активности кнопки подтверждения;
- `removeItem(id: string)` - удаление товара из корзины;
- `get form: HTMLElement` - геттер для получения элемента формы.
- сеттер для обновления содержимого корзины.

#### Класс `Product`
Отвечает за отображение карточки товара, задавая в ней: категорию, название, описание, изображение, цену. В конструктор класса передается DOM-элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми генерируются соответствующие события.\
Поля класса содержат элементы разметки карточки. Конструктор принимает и темплейт, и экземпляр `EventEmitter` для создания событий.\
Методы:
- `setData(productData: IProductItem): void` - заполняет атрибуты элементов карточки данными.
- `isInCart(): boolean` - возвращает наличие товара в корзине;
- `removeItem(id: string)` - удаление товара из корзины;
- `render(): HTMLElement` - метод возвращаает полностью заполненную карточку товара установленными слушателями;
- геттер id возвращает уникальный id товара.

#### Класс `ProductContainer`
Реализует отображение каталога товаров на главной странице.\
Метод:
- `addProduct(productElement: HTMLElement)` - добавляет карточки на страницу. 

#### Класс `UserCart`
Отвечает за отображение кнопки "Корзина" и количества товаров в ней на главном экране. Конструктор принимает элемент кнопки и экземпляр `EventEmitter` для создания события.\
Метод:
- `setUserCart(itemsCount: number)` - обновляет количество товаров в корзине;
- сеттер для обновления количества товаров в корзине.

### Слой коммуникации

#### Класс `AppApi`
Экземпляр класса `Api` передается в конструктор и предоставляет методы для взаимодействия с серверной частью сервиса.

## Взаимодействие компонентов
Код, отвечающий за связь между представлением и данными, находится в файле `index.ts`, который выступает в роли презентера.\
Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий и обработчиков этих событий, описанных в index.ts.\
Сначала в `index.ts` создаются экземпляры всех нужных классов, а затем настраивается обработка событий.

##### *События, которые могут создаваться в системе:*
Для хранения названий событий используется `enum EventNamesEnum`.

*События изменения данных (через классы моделей данных)*
- `CHANGED_PRODUCT_COUNT` - изменение количества добавленных товаров в корзину;
- `CHANGED_PRODUCT_ITEMS` - изменение массива товаров в корзине;
- `SELECTED_PRODUCT` - изменение отображения в модальном окне выбранной карточки товара.

*События, происходящие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `SELECT_PRODUCT` - выбор товара для отображения в модальном окне;
- `OPEN_PRODUCT_MODAL` - открытие модального окна "Карточка товара";
- `ADD_PRODUCT_IN_CART` - добавление товара в корзину;
- `CLOSE_PRODUCT_MODAL` - закрытие модального окна "Карточка товара";
- `OPEN_CART` - открытие модального окна "Корзина";
- `DELETE_PRODUCT_FROM_CART` - удаление товара из корзины;
- `SUBMIT_CART` -  переход к модальному окну оформления заказа "Оплата";
- `INPUT_FORM_PAYMENT` - изменение данных в форме с данными об оплате;
- `SUBMIT_FORM_PAYMENT` - сохранение данных в форме с данными об оплате;
- `VALIDATIOM_FORM_PAYMENT` - сообщает о необходимости валидаации формы оплаты;
- `CLICK_NEXT` - переход к форме с контактными данными;
- `INPUT_FORM_CONTACTS` - изменение данных в форме с контактными данными;
- `SUBMIT_FORM_CONTACTS` - сохранение данных в форме с контактными данными;
- `VALIDATIOM_FORM_CONTACTS` - сообщает о необходимости валидаации формы с контактными данными;
- `SUBMIT_ORDER` - отправка данных заказа на сервер;
- `RESET_CART` - очистка корзины.